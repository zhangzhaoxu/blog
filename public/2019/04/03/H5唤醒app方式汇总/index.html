<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="怀朔的博客">
    <meta name="keyword" content="前端">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        H5唤醒app方式汇总 - 怀朔的博客 | HuaiShuo&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> sometimes code， sometimes design </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>怀朔</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#H5唤醒App方式汇总"><span class="toc-text">H5唤醒App方式汇总</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> sometimes code， sometimes design </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        H5唤醒app方式汇总
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-04-03 15:00:00</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#javascript" title="javascript">javascript</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#H5与app交互" title="H5与app交互">H5与app交互</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h3 id="H5唤醒App方式汇总"><a href="#H5唤醒App方式汇总" class="headerlink" title="H5唤醒App方式汇总"></a>H5唤醒App方式汇总</h3><p>最近在做扫码之后的h5页面唤醒App的功能，做下记录</p>
<p><strong>1.唤醒方式列表</strong></p>
<ul>
<li>URL Schemes</li>
<li>chrome intent</li>
<li>ios UniversalLink / android appLink</li>
</ul>
<p><strong>2.常见唤醒媒介</strong></p>
<ul>
<li>iframe</li>
<li>a标签</li>
<li>window.location</li>
<li>URL Scheme</li>
</ul>
<p><strong>3.组成</strong><br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">scheme:</span>][<span class="symbol">//authority</span>][<span class="string">path</span>][<span class="symbol">?query</span>] 比如：tuyasmart://home?test=1</span><br></pre></td></tr></table></figure></p>
<p><strong>4.是什么</strong></p>
<p><em>URL Schemes</em>可以理解为一种特殊的URL用来定位一个应用以及应用内的某个功能，类比网页链接便很容易理解<br><em>Schemes</em> 表示的是URL中的一个位置 - 最初始的位置，既<code>://</code>之前的字符，比如<code>https://www.apple.com</code>的<em>Schemes</em>就是<code>https</code><br>通过<em>URL Schemes</em>, 我们就可以像定位一个网页一样，定位一个应用甚至应用内的某个具体的功能。而定位是哪个应用的，就是<em>Schemes</em>部分。比如短信应用的Schemes就是： sms<br>我们完全可以按照理解一个网页的URL来理解一个应用的URL<br>|| 网页（苹果）| 应用（微信）|<br>| 网站首页/打开应用 | <a href="https://www.apple.com" target="_blank" rel="noopener">https://www.apple.com</a> | weixin:// |<br>| 子页面/具体功能  | …/mac (Mac应用页) | weixin://dl/moments（朋友圈） |<br>注意点 - 应用是否支持<em>URL Schemes</em>要看App开发者有没有写那部分的代码了 - <em>URL Schemes</em> 不唯一</p>
<p><strong>5.使用</strong><br>使用方式十分简单，就像我们打开一个链接一样，常见的有</p>
<ul>
<li>location.href</li>
<li>iframe</li>
<li>a标签</li>
</ul>
<p><strong>6.使用中常见问题及解决方案</strong></p>
<ul>
<li>可能会被app禁掉，比如微信，qq等</li>
<li>ios9+ 禁止掉了iframe方式。</li>
<li>ios及部分安卓浏览器会提示用户是否打开App，并且ios在未安装对应App的时候，会提示“打不开网页，因为该网址无效”<br>h5无法感知是否唤醒成功</li>
<li>大部分浏览器需要用户手动触发链接，js自动触发无效</li>
</ul>
<p>针对被app禁止掉的情况，通常会判断是否微信等app环境，然后提示用户浏览器内打开 针对<em>ios9+ iframe</em> 被禁掉的情况，判断下ios版本 针对h5无法感知是否唤醒成功的解决办法是，<code>一段时间之后自动跳转下载页，或者是依赖setTimeout在浏览器进入后台后进程切换导致的时间延迟判断</code>。</p>
<p><strong>7.Intent</strong></p>
<p>安卓的原生谷歌浏览器从<em>chrome25</em>版本之后就不能通过<em>URL Schemes</em>唤醒安卓应用。要使用谷歌官方提供的<em>intent:</em>预发， 如果唤醒失败，则会跳转到谷歌的应用市场。语法与<em>URL Schemes</em>及其相似，相当于谷歌定制版的URL Schemes，也没用过，就不多说。</p>
<p><strong>8.IOS Universal Link</strong><br>简介 <em>Universal Link</em>是在iOS9引入的新功能，通过传统的HTTP链接就可以唤醒app，如果用户没有安装APP，则会跳转到该链接对应的页面，而且在唤醒app的时候没有弹框提示哦。可以说是解决了URL Schemes的大部分问题。</p>
<p><em>原理及流程</em></p>
<ul>
<li>App开发人员去配置中心配置Associated Domain配置一个支持https的域名，比如app-support.test.com</li>
<li>然后 app-support.test.com/apple-app-site-association或者app-support.test.com/apple-app-site-association/.well-known/apple-app-site-association要返回app的teamId,bundleId,paths信息</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/apple-app-site-association, (req, res) =&gt; &#123;</span></span><br><span class="line"><span class="string">  const data = &#123;</span></span><br><span class="line"><span class="string">    applinks: &#123;</span></span><br><span class="line"><span class="string">      apps: [],</span></span><br><span class="line"><span class="string">      details: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          appID: '</span>teamId.bundleId<span class="string">',</span></span><br><span class="line"><span class="string">          paths: ['</span>*<span class="string">']</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">  res.set('</span>Content-Type<span class="string">', '</span>text/html<span class="string">');</span></span><br><span class="line"><span class="string">  res.send(JSON.stringify(data));</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>然后APP安装后首次打开，如果Associated Domain配置了的话，就会去请求app-support.test.com/apple-app-site-association。系统会根据返回的teamId,bundleId,paths知道当打开app-support.test.com下的哪些路径的时候唤醒对应的app，比如paths=*的话，就是打开app-support.test.com下的任意路径都会唤醒app</p>
</li>
<li><p>app那边会收到对应的路径，然后要根据path写逻辑跳转到对应的功能</p>
</li>
</ul>
<p>如何验证配置成功 - 在备忘录中输入配置好的链接，直接点开这个链接(<a href="https://app-support.test.com)，配置好的话会直接跳到app，" target="_blank" rel="noopener">https://app-support.test.com)，配置好的话会直接跳到app，</a> 或者长按，弹出菜单中会提示在xxx中打开 - 在safari中</p>
<p><em>常见问题</em></p>
<ul>
<li>微信等几个App还是给屏蔽了</li>
<li>从9.3.X改版之后，通用链接不支持域内跳转了，跳转前后的两个domain必须是不同的，否则只会safari打开。比如知乎的网站地址是<a href="https://www.zhihu.com，而universal" target="_blank" rel="noopener">https://www.zhihu.com，而universal</a> link的地址是oia.zhihu.com</li>
<li>服务器上apple-app-site-association的更新不会让iOS本地的apple-app-site-association同步更新，即iOS只会在App第一次启动时请求一次，以后除非App更新或重新安装，否则不会在每次打开时请求apple-app-site-association。</li>
</ul>
<p><strong>9.Android App Links</strong><br>安卓<em>App Link**的出现原因也是为了优化用户体验，在使用scheme唤醒时会弹出一个对话框提示用户是否打开，并且如果用户勾选了取消之后，可能之后就再也唤醒不了。<br>安卓App Link的流程和</em>ios Universal link*的类似，iOS中需要配置的<code>app-support.test.com/apple-app-site-association</code>文件在安卓中叫做<code>app-support.test.com/.well-known/assetlinks.json</code>，只能放在.well-known下面</p>

        
            <div class="donate-container">
</div>
        
        <br />
        <div id="comment-container">
        </div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


    <script>
        /**
         *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
         *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
        */
        if( '' || '')
        var disqus_config = function () {
            this.page.url = '';  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };

        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://airclouds-blog.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>



</html>
